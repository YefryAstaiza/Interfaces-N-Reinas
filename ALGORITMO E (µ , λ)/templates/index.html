<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algoritmo Evolutivo (Œº,Œª) - Problema de las N-Reinas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Algoritmo Evolutivo (Œº , Œª) - Problema de las N-Reinas</h1>
            <p class="subtitle">Interfaz interactiva para resolver el problema de las N-Reinas utilizando algoritmos Evolutivo</p>
        </header>

        <div class="content">
            <div class="left-column">
                <div class="card">
                    <h2>Configuraci√≥n de Par√°metros</h2>
                    <form method="POST">
                        <div class="form-group">
                            <label for="n">N (tama√±o del tablero):</label>
                            <input type="number" id="n" name="n" value="{{ n }}" min="4" max="20" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="mu">Œº (tama√±o de poblaci√≥n de padres):</label>
                            <input type="number" id="mu" name="mu" value="{{ mu }}" min="10" max="200" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="lambd">Œª (n√∫mero de descendientes):</label>
                            <input type="number" id="lambd" name="lambd" value="{{ lambd }}" min="20" max="500" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="generations">N√∫mero m√°ximo de generaciones:</label>
                            <input type="number" id="generations" name="generations" value="{{ generations }}" min="10" max="500" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="mutation_rate">Tasa de mutaci√≥n:</label>
                            <input type="number" id="mutation_rate" name="mutation_rate" value="{{ mutation_rate }}" step="0.01" min="0" max="1" required>
                        </div>
                        
                        <button type="submit">Ejecutar algoritmo</button>
                    </form>
                </div>

                {% if best_solution %}
                <div class="card">
                    <h2>Resultados de la Ejecuci√≥n</h2>
                    <div class="results-grid">
                        <div class="solution-info">
                            <h3>Soluci√≥n Encontrada</h3>
                            <p><strong>Vector:</strong> <span class="param-value">{{ best_solution }}</span></p>
                            <p><strong>Conflictos:</strong> 
                                {% if best_fit == 0 %}
                                    <span class="success">{{ best_fit }} (Soluci√≥n √≥ptima)</span>
                                {% elif best_fit < 3 %}
                                    <span class="warning">{{ best_fit }} (Buena soluci√≥n)</span>
                                {% else %}
                                    <span class="danger">{{ best_fit }} (Soluci√≥n con conflictos)</span>
                                {% endif %}
                            </p>
                            <p><strong>Generaciones usadas:</strong> <span class="param-value">{{ analysis_data.generations_to_solution }}</span></p>
                            <p><strong>Tiempo de ejecuci√≥n:</strong> <span class="param-value">{{ "%.4f"|format(execution_time) }} segundos</span></p>
                        </div>
                        <div class="board-container">
                            <h3>Visualizaci√≥n del Tablero</h3>
                            <img src="data:image/png;base64,{{ tablero_img }}" alt="Tablero de N-Reinas" class="board-image">
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="right-column">
                <div class="card">
                    <h2>Registro del Algoritmo</h2>
                    <div class="log-container">
                        {% if log %}
                            <div class="log-content">
                                {% for line in log %}
                                    {% if '=' in line and line.strip() != '' %}
                                        <div class="log-header">{{ line }}</div>
                                    {% elif 'POBLACI√ìN INICIAL' in line or 'RESULTADOS FINALES' in line %}
                                        <div class="log-section">{{ line }}</div>
                                    {% elif 'Individuo' in line %}
                                        <div class="log-individual">{{ line }}</div>
                                    {% elif '‚Üí' in line %}
                                        <div class="log-conflicts">{{ line }}</div>
                                    {% elif 'üéâ' in line or '¬°SOLUCI√ìN' in line %}
                                        <div class="log-success">{{ line }}</div>
                                    {% elif 'Generaci√≥n' in line %}
                                        <div class="log-generation">{{ line }}</div>
                                    {% elif 'Estado:' in line %}
                                        {% if '‚úÖ' in line %}
                                            <div class="log-status" style="background: #d4edda; color: #155724; border-left: 4px solid #28a745;">{{ line }}</div>
                                        {% elif '‚ö°' in line %}
                                            <div class="log-status" style="background: #fff3cd; color: #856404; border-left: 4px solid #ffc107;">{{ line }}</div>
                                        {% elif '‚ö†Ô∏è' in line %}
                                            <div class="log-status" style="background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545;">{{ line }}</div>
                                        {% else %}
                                            <div class="log-status">{{ line }}</div>
                                        {% endif %}
                                    {% elif line.strip() == '' %}
                                        <br>
                                    {% else %}
                                        <div class="log-normal">{{ line }}</div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="log-placeholder">
                                <p>Ejecuta el algoritmo para ver el registro de evoluci√≥n...</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>An√°lisis de Resultados</h2>
                        {% if execution_history %}
                        <form method="POST" action="{{ url_for('clear_history') }}" style="display: inline;">
                            <button type="submit" class="btn-clear">Limpiar Historial</button>
                        </form>
                        {% endif %}
                    </div>
                    <div class="analysis">
                        {% if analysis_data %}
                        <div class="analysis-grid">
                            <div class="analysis-card">
                                <h3>Generaciones Necesarias</h3>
                                <p>Para N = <span class="param-value">{{ analysis_data.n }}</span>:</p>
                                <p>
                                    {% if analysis_data.solution_found %}
                                        Se necesitaron <span class="param-value success">{{ analysis_data.generations_to_solution }}</span> generaciones
                                    {% else %}
                                        No se encontr√≥ soluci√≥n √≥ptima en <span class="param-value danger">{{ analysis_data.total_generations }}</span> generaciones
                                    {% endif %}
                                </p>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>Influencia del Tama√±o de Poblaci√≥n</h3>
                                <p>Poblaci√≥n actual: Œº = <span class="param-value">{{ analysis_data.mu }}</span></p>
                                <p>
                                    {% if analysis_data.mu < 30 %}
                                        <span class="warning">Poblaci√≥n peque√±a. Puede tener dificultades para encontrar soluci√≥n.</span>
                                    {% elif analysis_data.mu > 100 %}
                                        <span class="success">Poblaci√≥n grande. Mayor diversidad gen√©tica.</span>
                                    {% else %}
                                        <span class="success">Poblaci√≥n equilibrada. Buen balance entre rendimiento y costo.</span>
                                    {% endif %}
                                </p>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>Influencia de la Tasa de Mutaci√≥n</h3>
                                <p>Tasa actual: <span class="param-value">{{ analysis_data.mutation_rate }}</span></p>
                                <p>
                                    {% if analysis_data.mutation_rate < 0.05 %}
                                        <span class="warning">Tasa muy baja. Riesgo de estancamiento.</span>
                                    {% elif analysis_data.mutation_rate > 0.3 %}
                                        <span class="warning">Tasa muy alta. Puede impedir convergencia.</span>
                                    {% else %}
                                        <span class="success">Tasa √≥ptima. Buen equilibrio entre exploraci√≥n y explotaci√≥n.</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        {% else %}
                        <p>Ejecuta el algoritmo para ver el an√°lisis de resultados...</p>
                        {% endif %}
                        
                        <h3 style="margin-top: 20px;">Registro Hist√≥rico de Ejecuciones</h3>
                        {% if execution_history %}
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>N</th>
                                    <th>Œº</th>
                                    <th>Œª</th>
                                    <th>Generaciones</th>
                                    <th>Conflictos</th>
                                    <th>Tasa Mutaci√≥n</th>
                                    <th>Tiempo (s)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for execution in execution_history %}
                                <tr>
                                    <td>{{ execution.n }}</td>
                                    <td>{{ execution.mu }}</td>
                                    <td>{{ execution.lambd }}</td>
                                    <td>{{ execution.generations }}</td>
                                    <td>
                                        {% if execution.conflicts == 0 %}
                                            <span class="success">{{ execution.conflicts }}</span>
                                        {% elif execution.conflicts < 3 %}
                                            <span class="warning">{{ execution.conflicts }}</span>
                                        {% else %}
                                            <span class="danger">{{ execution.conflicts }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ execution.mutation_rate }}</td>
                                    <td>{{ execution.get('execution_time', 0) | round(4) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <p>No hay ejecuciones registradas. Ejecuta el algoritmo para comenzar.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>